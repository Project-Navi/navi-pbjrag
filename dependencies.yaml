# Dependency Allow/Deny Lists
# Supply Chain Security Compliance
# Part of Neural Forge v1.3 Grumpy Inspector requirements

version: "1.0"
last_reviewed: "2025-12-05"
reviewer: "Alchemical Council"

# Allowed dependencies (explicit allowlist)
allowed:
  # Core dependencies - minimal attack surface
  runtime:
    - name: numpy
      min_version: "1.24.0"
      max_version: "2.0.0"
      justification: "Core numerical operations for field calculations"
      security_review: "2025-12-05"

    - name: requests
      min_version: "2.28.0"
      max_version: "3.0.0"
      justification: "HTTP client for optional API integrations"
      security_review: "2025-12-05"

  # Optional dependencies - vector storage
  vector_storage:
    - name: qdrant-client
      min_version: "1.6.0"
      max_version: "2.0.0"
      justification: "Vector database for semantic search"
      security_review: "2025-12-05"
      optional: true

  # Optional dependencies - LLM integration
  llm:
    - name: ollama
      min_version: "0.1.0"
      justification: "Local LLM inference"
      security_review: "2025-12-05"
      optional: true

  # Development dependencies
  development:
    - name: pytest
      min_version: "7.0.0"
      justification: "Testing framework"

    - name: pytest-cov
      min_version: "4.0.0"
      justification: "Coverage reporting"

    - name: ruff
      min_version: "0.1.0"
      justification: "Linting and formatting"

    - name: mypy
      min_version: "1.0.0"
      justification: "Static type checking"

    - name: black
      min_version: "23.0.0"
      justification: "Code formatting"

  # WebUI dependencies (isolated)
  webui:
    - name: streamlit
      min_version: "1.28.0"
      max_version: "2.0.0"
      justification: "Web interface framework"
      security_review: "2025-12-05"

    - name: watchdog
      version: "5.0.3"
      justification: "File watching for hot reload (pinned for compatibility)"
      security_review: "2025-12-05"

# Denied dependencies (explicit blocklist)
denied:
  # Security risks
  - name: pickle
    reason: "Arbitrary code execution vulnerability"
    alternative: "Use json or msgpack"

  - name: eval
    reason: "Code injection risk"
    alternative: "Use ast.literal_eval for safe parsing"

  - name: exec
    reason: "Code injection risk"
    alternative: "Design patterns that avoid dynamic execution"

  # Deprecated or unmaintained
  - name: nose
    reason: "Deprecated testing framework"
    alternative: "Use pytest"

  - name: setup.py
    reason: "Legacy packaging"
    alternative: "Use pyproject.toml"

  # License incompatibility
  - name: "*-gpl"
    reason: "GPL license incompatible with commercial licensing"
    alternative: "Use MIT/BSD/Apache licensed alternatives"

  # Known vulnerable versions
  - name: requests
    version: "<2.28.0"
    reason: "Known security vulnerabilities in older versions"

  - name: numpy
    version: "<1.22.0"
    reason: "Buffer overflow vulnerabilities"

# Transitive dependency policies
transitive:
  # Maximum depth for dependency tree
  max_depth: 5

  # Require all transitive deps to be explicitly reviewed
  require_review: false

  # Auto-deny if transitive dep has CVE
  deny_on_cve: true

  # Minimum days since last update
  max_stale_days: 365

# Audit configuration
audit:
  # Run on every PR
  on_pr: true

  # Run on every release
  on_release: true

  # Fail CI on violation
  fail_on_violation: true

  # Report format
  report_format: "sarif"

  # Notification channels
  notify:
    - type: github_issue
      on: new_vulnerability
    - type: slack
      on: critical_vulnerability
      channel: "#security-alerts"
