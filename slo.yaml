# Service Level Objectives for PBJRAG
# Version: 1.0.0

version: "1.0.0"

slos:
  analysis_latency:
    description: "Code analysis must complete within acceptable time"
    target: 0.99
    thresholds:
      small_code:
        p50: 500
        p95: 2000
        p99: 5000
      medium_code:
        p50: 2000
        p95: 10000
        p99: 30000

  availability:
    description: "Service must be available"
    target: 0.999
    measurement_window: "30d"

  error_rate:
    description: "Error rate must stay below threshold"
    target: 0.01
    exclude:
      - "InvalidInputError"
      - "RateLimitError"

  throughput:
    description: "Minimum requests per second supported"
    target: 100
    measurement_window: "1m"
    thresholds:
      analysis: 10
      search: 50
      health: 100

  error_budget:
    description: "Monthly error budget allocation"
    monthly_budget: 0.001  # 0.1% of requests can fail
    burn_rate_alerts:
      - threshold: 2.0
        window: "1h"
        severity: "warning"
      - threshold: 10.0
        window: "5m"
        severity: "critical"

  embedding_latency:
    description: "Embedding generation latency"
    target: 0.99
    thresholds:
      single: 100
      batch_100: 2000

  vector_search_latency:
    description: "Vector similarity search latency"
    target: 0.99
    thresholds:
      top_10: 50
      top_100: 200

rollback_triggers:
  - name: "high_error_rate"
    condition: "error_rate > 0.05"
    action: "automatic_rollback"

  - name: "latency_spike"
    condition: "p99_latency > 2x baseline"
    action: "alert_and_manual_review"

  - name: "availability_drop"
    condition: "availability < 0.99"
    action: "page_oncall"

alerting:
  channels:
    - type: "email"
      recipients: ["dev@projectnavi.ai"]

  rules:
    - name: "slo_breach"
      condition: "any slo < target"
      severity: "warning"

    - name: "rollback_triggered"
      condition: "rollback executed"
      severity: "critical"
